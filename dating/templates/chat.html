<<<<<<< HEAD
=======

>>>>>>> a895175acf332ece18893ab17618b06f53d3b2bf
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Chat - Dating App{% endblock %}</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
        }

        .chat-sidebar {
            background-color: #fff;
            width: 280px;
            padding: 20px;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.06);
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            height: 100vh; /* Make sidebar full height */
        }

        .sidebar-profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .sidebar-profile-picture-container {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 10px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e9ecef;
        }

        .sidebar-profile-picture-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sidebar-profile-info h6 {
            margin-bottom: 0;
            font-size: 1em;
            color: #333;
        }

        .sidebar-navigation button {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin-bottom: 10px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        .sidebar-navigation button:hover {
            background-color: #0056b3;
        }

        .matches-list-header {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #555;
            font-size: 0.9em;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .match-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }

        .match-item:last-child {
            border-bottom: none;
        }

        .match-item:hover {
            background-color: #f8f9fa;
        }

        .match-item-picture-container {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 10px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e9ecef;
        }

        .match-item-picture-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .match-item-info h6 {
            margin-bottom: 0;
            font-size: 0.9em;
            color: #333;
        }

        .chat-area {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: #f0f2f5;
        }

        #chat-display {
            overflow-y: auto;
            padding: 10px;
        }

        .message-container {
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            clear: both; /* Prevent floating issues */
        }

        .user-message {
            background-color: #e2f7cb;
            float: right;
            text-align: right;
        }

        .other-message {
            background-color: #fff;
            float: left;
            text-align: left;
        }

        .chat-input-area {
            display: flex;
            padding: 10px;
            background-color: #e9ecef;
            border-top: 1px solid #ddd;
        }

        #chat-message-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }

        #chat-send-button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #chat-send-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="chat-sidebar">
        <div class="sidebar-profile">
            <div class="sidebar-profile-picture-container">
                {% if current_user.profile_picture %}
                <img src="{{ url_for('static', filename='uploads/' ~ current_user.profile_picture) }}" alt="Your Profile">
                {% else %}
                <span>{{ current_user.first_name|first }}</span> {% endif %}
            </div>
            <div class="sidebar-profile-info">
                <h6>{{ current_user.first_name }}</h6>
                </div>
        </div>

        <div class="sidebar-navigation">
            <button onclick="window.location.href='/profile'">Profile</button>
            <button class="active">Messages</button>
            <button onclick="window.location.href='/matches'">Matches</button> <button onclick="window.location.href='/logout'">Logout</button>
        </div>

        <h6 class="matches-list-header">Recent Matches</h6>
        <div id="matches-list">
            {% if matches %}
                {% for match in matches %}
                <div class="match-item" onclick="loadChat('{{ match.id }}', '{{ match.name }}')">
                    <div class="match-item-picture-container">
                        {% if match.profile_picture %}
                        <img src="{{ url_for('static', filename='uploads/' ~ match.profile_picture) }}" alt="{{ match.name }}">
                        {% else %}
                        <span>{{ match.name|first }}</span> {% endif %}
                    </div>
                    <div class="match-item-info">
                        <h6>{{ match.name }}</h6>
                        </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No recent matches.</p>
            {% endif %}
        </div>
    </div>

    <div class="chat-area">
        <div id="chat-display">
            <p class="text-center text-muted">Select a chat to view messages.</p>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-message-input" placeholder="Enter your message">
            <button id="chat-send-button">Send</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const chatForm = document.querySelector('.chat-input-area');
        const messageInput = document.getElementById('chat-message-input');
        const chatDisplay = document.getElementById('chat-display');
        const matchesListDiv = document.getElementById('matches-list'); // Renamed for clarity
        let currentChatUserId = null;
        let currentChatUserName = null;

        function loadChat(userId, userName) {
            console.log(`Loading chat with ${userName} (ID: ${userId})`);
            currentChatUserId = userId;
            currentChatUserName = userName;
            chatDisplay.innerHTML = `<p class="text-center text-muted">Loading chat with ${userName}...</p>`;
            // Here you would make an AJAX request to fetch the chat messages for this userId
            // and update the chatDisplay.
        }

        chatForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const message = messageInput.value.trim();
            if (message && currentChatUserId) {
                console.log(`Sending message to ${currentChatUserName} (ID: ${currentChatUserId}): ${message}`);
                // Here you would make an AJAX request to send the message to the server
                const newMessage = document.createElement('div');
                newMessage.classList.add('message-container', 'user-message', 'mb-2', 'p-2', 'rounded');
                newMessage.textContent = message;
                chatDisplay.appendChild(newMessage);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
                messageInput.value = '';
            } else if (!currentChatUserId) {
                alert('Please select a chat to send a message.');
            }
        });

        // In a real application, you would fetch the list of matches dynamically
        // from your backend and populate the 'matches' variable in your template.
        // The 'matches' variable here is assumed to be a list of dictionaries
        // passed from your Flask route.
    </script>
</body>
<<<<<<< HEAD
</html>
=======
</html>

{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Cột bên trái: Danh sách đoạn chat -->
        <div class="col-md-4 border-end">
            <h4>Đoạn chat</h4>
            <div class="mb-3">
                <input type="text" class="form-control" placeholder="Tìm kiếm...">
            </div>
            <ul class="list-group">
                {% for c in chats %}
                <li class="list-group-item d-flex align-items-center {% if chat and c.id == chat.id %}active{% endif %}">
                    <a href="{{ url_for('chat', chat_id=c.id) }}" class="d-flex align-items-center text-decoration-none text-dark">
                        <img src="{{ c.user1.id == current_user.id and c.user2.avatar_url or c.user1.avatar_url or '/static/default-avatar.png' }}" alt="Avatar" class="rounded-circle me-3" style="width: 50px; height: 50px;">
                        <div>
                            <h6 class="mb-0">{{ c.user1_id == current_user.id and c.user2.username or c.user1.username }}</h6>
                            <small class="text-muted">{{ c.messages[-1].content if c.messages else "No messages yet" }}</small>
                        </div>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Khu vực bên phải: Nội dung chat -->
        <div class="col-md-8">
            <h4 class="mb-3">
                {% if chat %}
                    Chat with {{ chat.user1_id == current_user.id and chat.user2.username or chat.user1.username }}
                {% else %}
                    No chat selected.
                {% endif %}
            </h4>
            <div class="chat-box mb-3" style="height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;">
                {% for message in messages %}
                <div class="mb-2">
                    <strong>{{ message.sender.username }}:</strong>
                    <span>{{ message.content }}</span>
                    <small class="text-muted">{{ message.timestamp }}</small>
                </div>
                {% endfor %}
            </div>
            {% if chat %}
                <form action="{{ url_for('send_message', chat_id=chat.id) }}" method="post">
                    <div class="input-group">
                        <input type="text" name="message" class="form-control" placeholder="Type a message...">
                        <button type="submit" class="btn btn-primary">Send</button>
                    </div>
                </form>
            {% else %}
                <p class="text-muted">No chat selected. Please select a chat to start messaging.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

>>>>>>> a895175acf332ece18893ab17618b06f53d3b2bf
